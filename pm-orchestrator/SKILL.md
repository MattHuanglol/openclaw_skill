---
name: pm-orchestrator
description: Project management orchestrator for software development. Use when user asks to develop/fix code. PM acts as the "Architect/Reviewer" and delegates technical work to "Claude Code" via OpenSpec. Handles Kanban status updates automatically.
---

# PM Orchestrator (Spec-Driven + Kanban Auto)

## ğŸ”— Project Kanban Links
- **Local**: http://localhost:3001/
- **Tailscale / LAN**: http://100.96.208.119:3001/

This skill defines the high-level workflow for software development tasks, enforcing a **Review-First** approach using OpenSpec and strict Kanban synchronization.

## ğŸ­ Roles

- **PM (You)**: 
  - **Manager**: Checks Kanban for tasks, updates status, and reports to user.
  - **Architect**: Writes the initial Proposal (What & Why).
  - **Reviewer**: Reviews technical specs generated by Claude. Approves/Rejects.
  - **Does NOT** write implementation code directly.
- **Claude (Engineer)**:
  - **Planner/Coder**: Generates specs and implements code via the **claude-code skill** (`claude` CLI; single-shot uses `claude_code_run.py`).

## ğŸ”„ Execution Loop & Workflow

### Phase 1: Task Pickup (Trigger)
**Trigger**: User command OR Periodic Kanban check.
1.  **Identify**: Find the highest priority `Todo` task assigned to "å¦²å·±" (or user specified task).
2.  **Status Update**:
    - Move task to `In-Progress`.
    - `message action=send`: "ğŸš€ é–‹å§‹åŸ·è¡Œä»»å‹™ï¼š[Title] (UUID)"
    - **Enable Patrol**: `openclaw cron enable --id c7438563-e00f-40f0-b7cb-6468e96efef7`

### Phase 2: Progress Monitoring
**Trigger**: Event-driven monitor (Cron, every 5m).
- Monitoring is handled by the dedicated **kanban-dev-monitor** (JS runner). It wakes PM only on **events/stuck/finish/service-down**.
- **Stuck threshold**: 30 minutes (PM decides actions after wake).

### Phase 3: Spec Generation (Delegate to Claude)
PM delegates to Claude (MUST use `--dangerously-skip-permissions`):
```bash
claude -p "Read proposal.md. Generate full specs (specs/*.md), design.md, and tasks.md following OpenSpec conventions." --dangerously-skip-permissions --output-format json && \
openclaw agent --id main --message "claude done: Spec Gen"
```

### Phase 4: Spec Review & Auto-Implement (PM Gate)
**Trigger**: Incoming message "claude done: Spec Gen".
1.  **Wake Up**: PM wakes up upon receiving the message.
2.  **Review**: Read generated specs.
3.  **Decision**:
    -   If valid: **Auto-Proceed** to Phase 5.
    -   Report: "Specs generated & approved. Starting implementation..."
    -   If invalid: Stop and report issues.

### Phase 5: Implementation (Delegate to Claude)
PM delegates to Claude (via **claude-code skill**). After completion, **wake PM**; PM handles user-facing notification after verification:
```bash
# Recommended (single-shot): use the PTY wrapper from claude-code skill
python3 /home/matt/clawd/skills/custom/claude-code/scripts/claude_code_run.py \
  -p "Implement the approved tasks defined in openspec/changes/<feature>/tasks.md. Update checklist as you go." \
  --dangerously-skip-permissions \
  --output-format json && \
openclaw sessions send --agent main --message "claude done: Implementation <feature>"
```

### Phase 6: Verification & Delivery
**Trigger**: Incoming message "claude done: Implementation".
1.  **Wake Up**: Check the result log.
2.  **Smoke Test**: Run a quick verification (build/curl/test).
3.  **Kanban Sync**:
    - Mark all implemented subtasks as `done`.
    - Update task status to `Review`.
    - Add a discussion comment summarizing the work.
4.  **Report**: `message action=send` using the **Reporting Template** below.

## â™¾ï¸ The Automation Loop

The **Kanban Dev Monitor** is the heartbeat of the loop.

- **Frequency**: every 5 minutes (via Cron).
- **Event-Driven**: Wakes PM only on **events / stuck / finish / service-down**.
- **Closed-Loop Rule (Must)**: When the monitor wakes PM (e.g., "stuck" or "task picked up"):
  - PM must **continue the workflow automatically**.
  - Example: If awakened by "stuck", PM must inspect logs, then restart Claude or fix the issue, then resume.
  - Example: If awakened by "finish", PM must verify and move to Review.
- **Action ownership**: Monitor detects + wakes; **PM executes** the next corrective/progress action.

## âš ï¸ Global Rules
1.  **No Direct Coding**: Always delegate implementation to `claude-code`.
2.  **Strict Permission Bypass**: Always add `--dangerously-skip-permissions` to Claude Code commands to prevent hanging on prompts.
3.  **No Git Push**: Unless explicitly instructed.
4.  **Auto-Proceed (Strict)**: Once the USER explicitly approves development (e.g., "OKé–‹ç™¼/é–‹å§‹"), PM MUST **automatically proceed through all phases** (Spec -> Implement -> Review) without pausing to ask/report in between.
    - **Do NOT stop** after Spec Gen; verify and launch Implementation immediately.
    - **Do NOT stop** after Implementation; verify and move to Review immediately.
    - **Only pause if:** high-risk, blockers, or user intervention is explicitly required.
5.  **Always Update Kanban**: Status MUST reflect reality (Todo -> In-Progress -> Review).
6.  **Immediate Delivery Sync (Must)**: Once implementation + smoke test are completed, PM MUST immediately:
    - Append a delivery summary + acceptance checklist to the task discussion, and
    - Move the task to **`Review`**.
    Do not wait for the user to ask for status.
7.  **Wake Event**: Always use `openclaw agent --id main --message` to wake up.

## ğŸ“ Reporting Template
ğŸš€ **ä»»å‹™äº¤ä»˜å ±å‘Š (Task Delivery)**

ğŸ“Œ **ä»»å‹™**ï¼š#[Seq] [Title]
ğŸ”„ **éšæ®µ**ï¼šPhase 6 - Verification & Delivery

ğŸ“ **è®Šæ›´æ‘˜è¦**ï¼š
- [UI/Logic] ...
- [Fix] ...

âœ… **é©—æ”¶æ¸…å–® (Acceptance Checklist)**ï¼š
- [ ] ...
- [ ] ...

ğŸ“Š **çœ‹æ¿ç‹€æ…‹**ï¼šReview
